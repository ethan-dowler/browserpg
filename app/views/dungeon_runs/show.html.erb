<div class="mb-2">
  You're in the <strong><%= dungeon_run.dungeon.name %></strong> dungeon
</div>

<%= turbo_frame_tag :dungeon_panel do %>
  <%# current room %>
  <div class="mb-2">
    <b>Current Room:</b>
    <%= dungeon_run.current_room.name %>
  </div>

  <%# doors - TODO: improve layout/navigation %>
  <div class="mb-4">
    <% %w[north east south west].each do |direction| %>
      <% if dungeon_run.current_room.send(:"#{direction}_room").present? %>
        <div class="mb-1">
          <b><%= direction.titleize %>:</b>
          <%=
            link_to(
              dungeon_run.current_room.send(:"#{direction}_room").name,
              go_dungeon_run_path(dungeon_run, direction:),
              class: "Link"
            )
          %>
        </div>
      <% end %>
    <% end %>
  </div>

  <%= render CharacterSummaryComponent.new(dungeon_run.character) %>

  <% if dungeon_run.current_room.monsters.any? %>
    <div class="mb-4">
      <div class="text-l font-bold mb-1">
        Monsters
      </div>

      <% dungeon_run.current_room.monsters.each do |monster| %>
        <div class="mb-4 flex flex-col justify-center">
          <div class="mb-2">
            <%= monster.name %> Lvl. <%= monster.level %>
          </div>

          <div class="mb-2">
            HP: <%= monster.current_hp %> / <%= monster.max_hp %>
          </div>
          
          <% unless monster.defeated? %>
            <%=
              button_to(
                "Attack",
                attack_dungeon_run_monster_path(dungeon_run, monster),
                class: "Button"
              )
            %>
          <% end %>
        </div>
      <% end %>

      <%= render "layouts/flash_messages" %>
    </div>
  <% end %>

  <% if dungeon_run.current_room.exit? %>
    <div>
      <i>There's an exit...</i>
      <%=
        button_to(
          "Leave Dungeon",
          end_dungeon_run_path(dungeon_run),
          class: "Button",
          form: { data: { "turbo-frame": "_top" } }
        )
      %>
    </div>
  <% end %>
<% end %>
